<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction to Tracing - Logging with Bevy</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intoduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> Println </a></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Redirecting output to a file</a></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> Dbg</a></li><li class="chapter-item expanded "><a href="chapter_4.html"><strong aria-hidden="true">4.</strong> The log plugin</a></li><li class="chapter-item expanded "><a href="chapter_5.html" class="active"><strong aria-hidden="true">5.</strong> Introduction to Tracing</a></li><li class="chapter-item expanded "><a href="chapter_6.html"><strong aria-hidden="true">6.</strong> Tracing Multiple outputs</a></li><li class="chapter-item expanded "><a href="chapter_7.html"><strong aria-hidden="true">7.</strong> Putting Layers into default plugin</a></li><li class="chapter-item expanded "><a href="future.html"><strong aria-hidden="true">8.</strong> Other features I have thought of using</a></li><li class="chapter-item expanded "><a href="chapter_8.html"><strong aria-hidden="true">9.</strong> Further Info</a></li><li class="chapter-item expanded "><a href="patterns.html"><strong aria-hidden="true">10.</strong> Design patterns</a></li><li class="chapter-item expanded "><a href="subscribers.html"><strong aria-hidden="true">11.</strong> Other Subscribers</a></li><li class="chapter-item expanded "><a href="performance.html"><strong aria-hidden="true">12.</strong> Performance</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">13.</strong> Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Logging with Bevy</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction-to-tracing"><a class="header" href="#introduction-to-tracing">Introduction to Tracing</a></h1>
<h2 id="about-tracing"><a class="header" href="#about-tracing">About Tracing</a></h2>
<p><a href="https://crates.io/crates/tracing">Tracing</a>  <code>tracing</code> is a framework for instrumenting Rust programs to collect structured, event-based diagnostic information."</p>
<p>Tracing is made for and often talked about in regards to asynchronous code, which is where a lot of documentation and discussion is addresses.</p>
<p>However, you don't need to use async code to benefit from this crate. I expect I will use this crate for every non-trivial program I write in Rust!</p>
<h2 id="why-use-tracing"><a class="header" href="#why-use-tracing">Why use Tracing</a></h2>
<ul>
<li>Instead of deleting logs that you are not actively using, you can stop sending those logs until they are needed.</li>
<li>You can log to multiple files by category</li>
</ul>
<h2 id="next-steps-from-what-we-have-learned"><a class="header" href="#next-steps-from-what-we-have-learned">Next Steps from what we have learned</a></h2>
<p>So far, we have learned about logging levels and filtering by module. Our next goal is to learn how to add more context to our logs.</p>
<h3 id="instrument"><a class="header" href="#instrument">instrument</a></h3>
<p><code>instrument</code> adds more context to your functions</p>
<pre><code class="language-rust">
use bevy::{log::LogPlugin, prelude::*};
use rand::prelude::*;
use tracing::Level;

fn main() {
    App::new()
        .add_plugins(DefaultPlugins.set(LogPlugin {
            filter: "warn,test_spiral=trace,test_spiral::spammy=info".to_string(),
            level: Level::TRACE,
            ..Default::default()
        }))
        .add_systems(Startup, setup)
        .add_systems(Startup, spammy::print_trash)
        .run();
}

fn setup(
    mut commands: Commands,
    mut meshes: ResMut&lt;Assets&lt;Mesh&gt;&gt;,
    mut materials: ResMut&lt;Assets&lt;StandardMaterial&gt;&gt;,
) {
    info!("Hello Log");
    debug!("Don't hide me");
    // Camera
    commands.spawn(Camera3dBundle {
        transform: Transform::from_xyz(0.0, 50.0, 100.0).looking_at(Vec3::ZERO, Vec3::Y),
        ..default()
    });

    // Light
    commands.spawn(PointLightBundle {
        point_light: PointLight {
            intensity: 1500.0,
            shadows_enabled: true,
            ..default()
        },
        transform: Transform::from_xyz(4.0, 8.0, 4.0),
        ..default()
    });

    let mut rng = rand::thread_rng();

    // Create spiral galaxy
    for i in 0..10000 {
        let t = i as f32 * 0.005;
        let r = 20.0 * t.sqrt();
        let theta = t * 2.5;

        let x = r * theta.cos();
        let z = r * theta.sin();
        let y = (rng.gen::&lt;f32&gt;() - 0.5) * 2.0; // Add some vertical spread

        let size = (0.05 + rng.gen::&lt;f32&gt;() * 0.1) * (1.0 - t / 50.0); // Smaller stars towards the edge
        let brightness = 1.0 - t / 50.0; // Dimmer stars towards the edge

        let color = Color::srgb(brightness, brightness * 0.8 + 0.2, brightness * 0.6 + 0.4);
        let emissive = Color::srgb(
            brightness * 5.0,
            (brightness * 0.8 + 0.2) * 5.0,
            (brightness * 0.6 + 0.4) * 5.0,
        );

        commands.spawn(PbrBundle {
            mesh: meshes.add(Mesh::from(Sphere { radius: size })),
            material: materials.add(StandardMaterial {
                base_color: color,
                emissive: emissive.into(), // Make stars glow
                ..default()
            }),
            transform: Transform::from_xyz(x, y, z),
            ..default()
        });
    }
}

mod spammy {
    use tracing::{debug, info, instrument, trace};

    pub fn print_trash() {
        debug!("I am going to print trash");
        for i in 0..10 {
            trace!(?i);
            some_function(i);
        }
    }
    #[instrument]
    fn some_function(i: u8) {
        if i == 3 {
            info!("Fizz");
        }
    }
}</code></pre>
<p>Of particular note is <code>instrument</code></p>
<pre><code class="language-rust">#[instrument]
    fn some_function(i: u8) {
        if i == 3 {
            info!("Fizz");
        }
    }</code></pre>
<p>Let's run</p>
<pre><code>     Running `target/debug/test_spiral`
2024-10-19T22:42:47.680435Z  WARN wgpu_hal::vulkan::instance: InstanceFlags::VALIDATION requested, but unable to find layer: VK_LAYER_KHRONOS_validation    
2024-10-19T22:42:47.690495Z  WARN wgpu_hal::vulkan::instance: GENERAL [Loader Message (0x0)]
        terminator_CreateInstance: Failed to CreateInstance in ICD 4.  Skipping ICD.    
2024-10-19T22:42:47.690509Z  WARN wgpu_hal::vulkan::instance:   objects: (type: INSTANCE, hndl: 0x56938d752410, name: ?)    
2024-10-19T22:42:47.697443Z  WARN wgpu_hal::gles::egl: No config found!    
2024-10-19T22:42:47.697458Z  WARN wgpu_hal::gles::egl: EGL says it can present to the window but not natively    
2024-10-19T22:42:48.169391Z  INFO test_spiral: Hello Log
2024-10-19T22:42:48.169411Z DEBUG test_spiral: Don't hide me
2024-10-19T22:42:48.169448Z  INFO some_function{i=3}: test_spiral::spammy: Fizz
</code></pre>
<p>Notice that <code>some_function</code> is now printing along with its argument some more context.</p>
<p>We can skip the arguments using <code>skip_all</code>, which can be useful if some arguments don't implement <code>Debug</code>.</p>
<p><code>#[instrument(skip_all)]</code></p>
<p>I tend to use <code>skip_all</code> for all my systems as queries can be quite spammy.
If I, for example, create a system to query all transforms</p>
<p><code>.add_systems(Update, some_queries.run_if(run_once()))</code></p>
<pre><code class="language-rust">#[instrument]
fn some_queries(transformers: Query&lt;&amp;Transform&gt;) {
    info!("not actually going to run");
}</code></pre>
<p>The output gets quite verbose per query.</p>
<pre><code>     Running `target/debug/test_spiral`
2024-10-19T22:49:03.036115Z  WARN wgpu_hal::vulkan::instance: InstanceFlags::VALIDATION requested, but unable to find layer: VK_LAYER_KHRONOS_validation    
2024-10-19T22:49:03.046122Z  WARN wgpu_hal::vulkan::instance: GENERAL [Loader Message (0x0)]
        terminator_CreateInstance: Failed to CreateInstance in ICD 4.  Skipping ICD.    
2024-10-19T22:49:03.046136Z  WARN wgpu_hal::vulkan::instance:   objects: (type: INSTANCE, hndl: 0x57ca2fa1e580, name: ?)    
2024-10-19T22:49:03.053094Z  WARN wgpu_hal::gles::egl: No config found!    
2024-10-19T22:49:03.053108Z  WARN wgpu_hal::gles::egl: EGL says it can present to the window but not natively    
2024-10-19T22:49:03.537979Z  INFO setup: test_spiral: Hello Log
2024-10-19T22:49:03.538003Z DEBUG setup: test_spiral: Don't hide me
2024-10-19T22:49:03.537998Z  INFO some_function{i=3}: test_spiral::spammy: Fizz
2024-10-19T22:49:04.866039Z  INFO some_queries{transformers=Query 
{ matched_entities: 10002, state: QueryState { world_id: WorldId(0), matched_table_count: 3, matched_archetype_count: 3, .. }, 
last_run: Tick { tick: 1036800056 }, this_run: Tick { tick: 57 }, 
world: World { id: WorldId(0), entity_count: 10003, archetype_count: 8, component_count: 239, resource_count: 190 } }}: 
test_spiral: not actually going to run
</code></pre>
<p>Note I added the line breaks to fit the margins</p>
<p>So let's add <code>skip_all</code><br />
<code>#[instrument(skip_all)]</code></p>
<p>The output</p>
<pre><code>     Running `target/debug/test_spiral`
2024-10-21T08:12:11.871245Z  WARN wgpu_hal::vulkan::instance: InstanceFlags::VALIDATION requested, but unable to find layer: VK_LAYER_KHRONOS_validation    
2024-10-21T08:12:11.880725Z  WARN wgpu_hal::vulkan::instance: GENERAL [Loader Message (0x0)]
        terminator_CreateInstance: Failed to CreateInstance in ICD 4.  Skipping ICD.    
2024-10-21T08:12:11.880740Z  WARN wgpu_hal::vulkan::instance:   objects: (type: INSTANCE, hndl: 0x56a5fc78b4c0, name: ?)    
2024-10-21T08:12:11.887924Z  WARN wgpu_hal::gles::egl: No config found!    
2024-10-21T08:12:11.887939Z  WARN wgpu_hal::gles::egl: EGL says it can present to the window but not natively    
2024-10-21T08:12:12.345086Z  INFO test_spiral: Hello Log
2024-10-21T08:12:12.345107Z DEBUG test_spiral: Don't hide me
2024-10-21T08:12:12.345155Z  INFO some_function{i=3}: test_spiral::spammy: Fizz
2024-10-21T08:12:13.653510Z  INFO some_queries: test_spiral: not actually going to run
</code></pre>
<p>If you recall, an earlier section of the book says to equate targets with modules <em>for now</em>.</p>
<p>You can change that using arguments to instruments. This will not be demonstrated, however,
as I have never had a need for it yet.</p>
<p>More about instruments <a href="https://docs.rs/tracing/latest/tracing/attr.instrument.html">here</a></p>
<h3 id="spans"><a class="header" href="#spans">Spans</a></h3>
<p>I think of spans as tags, I don't have a lot of experience with them so this will be brief and incomplete.</p>
<p>My main use case for tags is grouping structually unrelated code that has a common theme such as timing or system type.</p>
<p>The examples for me are</p>
<ul>
<li>Startup systems</li>
<li>Yearly or montly systems in my stratergy games</li>
<li>Related ui or input handling</li>
</ul>
<p>You can use as many spans as you want.</p>
<p>Now lets look at the syntax to use a span inside a fuction.
You need code that looks like this</p>
<pre><code class="language-rust">let span = span!(Level::DEBUG, "start");
let _guard = span.enter();</code></pre>
<p>Spans only apply when the logging level is set at it or above.</p>
<p>Note <code>_guard</code> is there to stop the variable being dropped immediately.
The underscore is to stop unused errors as its drop behaviour is what really makes it work!</p>
<p>While <code>_guard</code> is valid(undropped) the span is entered.
While <code>span</code> is valid the span is created.</p>
<p>There are shorthands for all logging levels, such as <code>trace_span!</code></p>
<p>You cannot combine the <code>span(/* snip*/).enter</code>  into one line as <em>entering</em> a span and <em>creating</em>
are distinct things. A span is only <em>created</em> once while a span can be <em>entered</em> many times.</p>
<p>Entering and exiting spans is <del>stuff I don't have much idea about</del> beyond the scope this tutorial(mostly async stuff).</p>
<p>Spans <em>exit</em> when the variable holding the enter is dropped in this example the <code>_guard</code>
spans <em>close</em> when the span variable is dropped.</p>
<p>We can use square brackets to filter by span</p>
<p><code>filter: "warn,test_spiral=trace,test_spiral::spammy=info,test_spiral[start]=trace"</code></p>
<p>Now for the entire code</p>
<pre><code class="language-rust">use bevy::{log::LogPlugin, prelude::*};
use rand::prelude::*;
use tracing::{instrument, span, Level};

fn main() {
    App::new()
        .add_plugins(
            DefaultPlugins.set(LogPlugin {
                filter: "warn,test_spiral=debug,test_spiral::spammy=info,test_spiral[start]=trace"
                    .to_string(),
                level: Level::TRACE,
                ..Default::default()
            }),
        )
        .add_systems(Startup, setup)
        .add_systems(Startup, spammy::print_trash)
        .add_systems(Update, some_queries.run_if(run_once()))
        .run();
}

#[instrument(skip_all)]
fn setup(
    mut commands: Commands,
    mut meshes: ResMut&lt;Assets&lt;Mesh&gt;&gt;,
    mut materials: ResMut&lt;Assets&lt;StandardMaterial&gt;&gt;,
) {
    let span = span!(Level::DEBUG, "start");
    let _guard = span.enter();

    info!("Hello Log");
    debug!("Don't hide me");
    // Camera
    commands.spawn(Camera3dBundle {
        transform: Transform::from_xyz(0.0, 50.0, 100.0).looking_at(Vec3::ZERO, Vec3::Y),
        ..default()
    });

    // Light
    commands.spawn(PointLightBundle {
        point_light: PointLight {
            intensity: 1500.0,
            shadows_enabled: true,
            ..default()
        },
        transform: Transform::from_xyz(4.0, 8.0, 4.0),
        ..default()
    });

    let mut rng = rand::thread_rng();

    // Create spiral galaxy
    for i in 0..10000 {
        let t = i as f32 * 0.005;
        let r = 20.0 * t.sqrt();
        let theta = t * 2.5;

        let x = r * theta.cos();
        let z = r * theta.sin();
        let y = (rng.gen::&lt;f32&gt;() - 0.5) * 2.0; // Add some vertical spread

        let size = (0.05 + rng.gen::&lt;f32&gt;() * 0.1) * (1.0 - t / 50.0); // Smaller stars towards the edge
        let brightness = 1.0 - t / 50.0; // Dimmer stars towards the edge

        let color = Color::srgb(brightness, brightness * 0.8 + 0.2, brightness * 0.6 + 0.4);
        let emissive = Color::srgb(
            brightness * 5.0,
            (brightness * 0.8 + 0.2) * 5.0,
            (brightness * 0.6 + 0.4) * 5.0,
        );

        commands.spawn(PbrBundle {
            mesh: meshes.add(Mesh::from(Sphere { radius: size })),
            material: materials.add(StandardMaterial {
                base_color: color,
                emissive: emissive.into(), // Make stars glow
                ..default()
            }),
            transform: Transform::from_xyz(x, y, z),
            ..default()
        });
    }
}

#[instrument(skip_all)]
fn some_queries(transformers: Query&lt;&amp;Transform&gt;) {
    info!("not actually going to run");
    trace!("shouldn't appear");
}

mod spammy {
    use tracing::{debug, info, instrument, span, trace, Level};

    pub fn print_trash() {
        let span = span!(Level::DEBUG, "start");
        let _guard = span.enter();

        debug!("I am going to print trash");
        for i in 0..10 {
            trace!(?i);
            some_function(i);
        }
    }
    #[instrument]
    fn some_function(i: u8) {
        if i == 3 {
            info!("Fizz");
        }
    }
}
</code></pre>
<p>The output</p>
<pre><code>     Running `target/debug/test_spiral`
2024-10-19T23:11:16.601564Z  WARN wgpu_hal::vulkan::instance: InstanceFlags::VALIDATION requested, but unable to find layer: VK_LAYER_KHRONOS_validation    
2024-10-19T23:11:16.611283Z  WARN wgpu_hal::vulkan::instance: GENERAL [Loader Message (0x0)]
        terminator_CreateInstance: Failed to CreateInstance in ICD 4.  Skipping ICD.    
2024-10-19T23:11:16.611297Z  WARN wgpu_hal::vulkan::instance:   objects: (type: INSTANCE, hndl: 0x5662f0635080, name: ?)    
2024-10-19T23:11:16.618229Z  WARN wgpu_hal::gles::egl: No config found!    
2024-10-19T23:11:16.618243Z  WARN wgpu_hal::gles::egl: EGL says it can present to the window but not natively    
2024-10-19T23:11:17.119600Z DEBUG start: test_spiral::spammy: I am going to print trash
2024-10-19T23:11:17.119605Z  INFO setup:start: test_spiral: Hello Log
2024-10-19T23:11:17.119626Z TRACE start: test_spiral::spammy: i=0
2024-10-19T23:11:17.119633Z DEBUG setup:start: test_spiral: Don't hide me
2024-10-19T23:11:17.119652Z TRACE start: test_spiral::spammy: i=1
2024-10-19T23:11:17.119665Z TRACE start: test_spiral::spammy: i=2
2024-10-19T23:11:17.119678Z TRACE start: test_spiral::spammy: i=3
2024-10-19T23:11:17.119688Z  INFO start:some_function{i=3}: test_spiral::spammy: Fizz
2024-10-19T23:11:17.119698Z TRACE start: test_spiral::spammy: i=4
2024-10-19T23:11:17.119711Z TRACE start: test_spiral::spammy: i=5
2024-10-19T23:11:17.119723Z TRACE start: test_spiral::spammy: i=6
2024-10-19T23:11:17.119736Z TRACE start: test_spiral::spammy: i=7
2024-10-19T23:11:17.119748Z TRACE start: test_spiral::spammy: i=8
2024-10-19T23:11:17.119760Z TRACE start: test_spiral::spammy: i=9
2024-10-19T23:11:18.441500Z  INFO some_queries: test_spiral: not actually going to run
</code></pre>
<h2 id="using-tracing-on-its-own"><a class="header" href="#using-tracing-on-its-own">Using Tracing on its own</a></h2>
<p>For the sake of learning we will disable the default plugin and use the <code>tracing</code> crate itself.
This also means you can use what you learned here on other applications using <code>tracing</code>.
Tracing uses a subscriber made up of layers (I don't really understand the details)</p>
<pre><code class="language-rust">use bevy::{log::LogPlugin, prelude::*};
use rand::prelude::*;
use tracing::{instrument, span, Level};

fn main() {
    tracing_subscriber::fmt().init();

    App::new()
        //Disable the defaults
        .add_plugins(DefaultPlugins.build().disable::&lt;LogPlugin&gt;())
        .add_systems(Startup, setup)
        .add_systems(Startup, spammy::print_trash)
        .add_systems(Update, some_queries.run_if(run_once()))
        .run();
}</code></pre>
<p>Let's modify Tracing</p>
<pre><code class="language-rust">tracing_subscriber::fmt()
  .without_time()
  .with_file(true)
  .with_line_number(true)
  .pretty()
  .with_env_filter(
      EnvFilter::from_str(
          "warn,test_spiral=debug,test_spiral::spammy=info,test_spiral[start]=trace",
      )
      .unwrap(),
  )
  .init();
</code></pre>
<ul>
<li>
<p>I find timestamp is spammy with diff files so thats why <code>without_time</code> is there.</p>
</li>
<li>
<p>I mentioned that <code>dbg!</code> had line numbers and file names, <code>with_file(true)</code>,<code>with_line_numbers(true)</code>.</p>
</li>
<li>
<p>Pretty is useful for console, remove if you are redirecting to a txt file</p>
</li>
</ul>
<p>Now, let's run</p>
<pre><code>     Running `target/debug/test_spiral`
   WARN wgpu_hal::vulkan::instance: InstanceFlags::VALIDATION requested, but unable to find layer: VK_LAYER_KHRONOS_validation
    at /home/lyndonm/.cargo/registry/src/index.crates.io-6f17d22bba15001f/wgpu-hal-0.21.1/src/vulkan/instance.rs:724

   WARN wgpu_hal::vulkan::instance: GENERAL [Loader Message (0x0)]
        terminator_CreateInstance: Failed to CreateInstance in ICD 4.  Skipping ICD.
    at /home/lyndonm/.cargo/registry/src/index.crates.io-6f17d22bba15001f/wgpu-hal-0.21.1/src/vulkan/instance.rs:89

   WARN wgpu_hal::vulkan::instance:     objects: (type: INSTANCE, hndl: 0x5fb6876377c0, name: ?)
    at /home/lyndonm/.cargo/registry/src/index.crates.io-6f17d22bba15001f/wgpu-hal-0.21.1/src/vulkan/instance.rs:148

   WARN wgpu_hal::gles::egl: No config found!
    at /home/lyndonm/.cargo/registry/src/index.crates.io-6f17d22bba15001f/wgpu-hal-0.21.1/src/gles/egl.rs:269

   WARN wgpu_hal::gles::egl: EGL says it can present to the window but not natively
    at /home/lyndonm/.cargo/registry/src/index.crates.io-6f17d22bba15001f/wgpu-hal-0.21.1/src/gles/egl.rs:258

  DEBUG test_spiral::spammy: I am going to print trash
    at src/main.rs:107
    in test_spiral::spammy::start

   INFO test_spiral: Hello Log
    at src/main.rs:40
    in test_spiral::start
    in test_spiral::setup

  TRACE test_spiral::spammy: i: 0
    at src/main.rs:109
    in test_spiral::spammy::start

  DEBUG test_spiral: Don't hide me
    at src/main.rs:41
    in test_spiral::start
    in test_spiral::setup

  TRACE test_spiral::spammy: i: 1
    at src/main.rs:109
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 2
    at src/main.rs:109
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 3
    at src/main.rs:109
    in test_spiral::spammy::start

   INFO test_spiral::spammy: Fizz
    at src/main.rs:116
    in test_spiral::spammy::some_function with i: 3
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 4
    at src/main.rs:109
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 5
    at src/main.rs:109
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 6
    at src/main.rs:109
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 7
    at src/main.rs:109
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 8
    at src/main.rs:109
    in test_spiral::spammy::start

  TRACE test_spiral::spammy: i: 9
    at src/main.rs:109
    in test_spiral::spammy::start

   INFO test_spiral: not actually going to run
    at src/main.rs:96
    in test_spiral::some_queries
</code></pre>
<p>Line numbers and file names. You may be happy to just work on your game from this point.
Next chapters is basically breaking Tracing up into layers so you can have multiple specialized files.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="chapter_4.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="chapter_6.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="chapter_4.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="chapter_6.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
